<!-- @format -->

<!DOCTYPE html>
<html lang="en"
  ><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>{{ title }}</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      rel="icon"
      type="image/png"
      href="https://colorlib.com/etc/lf/Login_v1/images/icons/favicon.ico"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/bootstrap.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/font-awesome.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/animate.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/hamburgers.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/select2.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/util.css') }}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/main.css') }}"
    />

    <meta name="robots" content="noindex, follow" />

    <script>
      // TODO - add login script
      // check for valid email
      // check for valid password
      // encrypt password
      // if valid, send post request to server
      // if server returns success, redirect to home page
      // if server returns failure, display error message
      function login() {
        var email = document.getElementById('login_email').value
        var password = document.getElementById('login_pass').value
        const isValid = checkIfAllIsValid(email, password)

        if (checkIfAllIsValid(email, password)) {
          var form = document.createElement('form')
          var form = document.createElement('form')
          form.setAttribute('method', 'post')
          form.setAttribute('action', 'login')
          console.log(form)

          var hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'src')
          hiddenField.setAttribute('value', 'home')
          form.appendChild(hiddenField)
          var hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'action')
          hiddenField.setAttribute('value', 'login')
          form.appendChild(hiddenField)
          console.log(form)

          var hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'email')
          hiddenField.setAttribute('value', email)
          form.appendChild(hiddenField)
          hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'pass')
          hiddenField.setAttribute('value', sha256(password))
          console.log(form)

          form.appendChild(hiddenField)
          document.body.appendChild(form)
          console.log(form)
          form.submit()
        }
      }
      // TODO - add signup script
      // TODO - add validateEmail script
      // check for valid email
      // if valid, return true
      // if invalid, display error message and return false

      function signup() {
        var email = document.getElementById('signup_email').value
        var password = document.getElementById('signup_pass').value
        var confirm_password = document.getElementById('confirm_pass').value
        var isValid = checkIfAllIsValid(email, password, confirm_password)
        if (isValid) {
          var form = document.createElement('form')
          form.setAttribute('method', 'post')
          form.setAttribute('action', 'signup')

          var hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'action')
          hiddenField.setAttribute('value', 'signup')
          form.appendChild(hiddenField)

          var hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'email')
          hiddenField.setAttribute('value', email)
          form.appendChild(hiddenField)
          hiddenField = document.createElement('input')
          hiddenField.setAttribute('type', 'hidden')
          hiddenField.setAttribute('name', 'pass')
          hiddenField.setAttribute('value', sha256(password))

          form.appendChild(hiddenField)
          document.body.appendChild(form)
          form.submit()
        }
      }

      function checkIfAllIsValid(email, pass, confirmPass) {
        if (validateEmail(email) && validatePassword(pass)) {
          if (confirmPass) {
            if (validatePasswordMatch(pass, confirmPass)) {
              return true
            } else {
              return false
            }
          } else {
            return true
          }
        } else {
          return false
        }
      }

      function validateEmail(email, isSignup = false) {
        emailId = isSignup ? 'signup_email' : 'login_email'
        var emailInput = document.getElementById(emailId)
        emailInput.style.boxShadow = 'none'
        var re =
          /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
        if (re.test(email)) {
          return true
        } else {
          emailInput.style.boxShadow = '0 0 0 2px red'
          return false
        }
      }
      // TODO - add validatePassword script
      // check for valid password
      // if valid, return true
      // if not matching display error message and return false
      function validatePassword(password, isSignup = false) {
        var passId = isSignup ? 'signup_pass' : 'login_pass'
        var passInput = document.getElementById(passId)
        passInput.style.boxShadow = 'none'
        var re =
          /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@#$!%*?&])[A-Za-z\d@#$!%*?&]{8,}$/
        if (re.test(String(password))) {
          return true
        } else {
          passInput.style.boxShadow = '0 0 0 2px red'
          return false
        }
      }
      // TODO - add validatePasswordMatch script
      // check for matching passwords
      // if matching return true
      // if not matching display error message and return false
      function validatePasswordMatch(password, password2) {
        var passInput = document.getElementById('confirm_pass')
        passInput.style.boxShadow = 'none'
        if (password == password2) {
          return true
        } else {
          passInput.style.boxShadow = '0 0 0 2px red'
          return false
        }
      }

      // ----------------------------

      // Display error message when registration failed
    </script>
  </head>
  <body>
    <div class="main">
      <nav>
        <img src="../static/assets/logo.png" alt="" />
      </nav>
      <div class="content" style="position: relative">
        <div style="margin: auto; width: 100%">
          <form class="card" id="login_form">
            <h1 style="font-size: 1.25rem">Sign in to your account</h1>
            <div>
              <label for="email">Email</label>
              <input
                type="text"
                name="email"
                id="login_email"
                value="{{ login_email }}"
              />
            </div>
            <div>
              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                "
              >
                <label for="password">Password</label>
                <label for="password"
                  ><a href="#">Forgot your password?</a></label
                >
              </div>
              <input
                type="password"
                name="pass"
                id="login_pass"
                value="{{ login_password }}"
              />
            </div>
            <a onclick="login()" role="button" href="#">Continue</a>
            <hr />
            <div class="selector">
              <button
                type="button"
                onclick="document.getElementById('login_form').style.display='flex';document.getElementById('signup_form').style.display='none';"
                class="selector-btn"
                >Log In</button
              >
              <button
                style="margin-left: 5px"
                class="selector-btn"
                active="false"
                type="button"
                onclick="document.getElementById('login_form').style.display='none';document.getElementById('signup_form').style.display='flex'; document.getElementsByClassName('selector-btn')[3].setAttribute('active', 'true'); document.getElementsByClassName('selector-btn')[2].setAttribute('active', 'false'); document.getElementsByClassName('selector-btn')[0].setAttribute('active', 'false');"
                >Sign Up</button
              >
            </div>
          </form>
          <form class="card" id="signup_form" style="display: none">
            <h1 style="font-size: 1.25rem">Create your account</h1>
            <div data-validate="Valid email is required: ex@abc.xyz">
              <label for="email">Email</label>
              <input
                type="text"
                name="email"
                id="signup_email"
                action="signup"
                value="{{ signup_email }}"
              />
            </div>
            <div data-validate="Password is required">
              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                "
              >
                <label for="password">Password</label>
              </div>
              <input
                type="password"
                id="signup_pass"
                action="signup"
                value="{{ signup_password }}"
              />
            </div>
            <div data-validate="Password is required">
              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                "
              >
                <label for="password">Confirm Password</label>
              </div>
              <input
                type="password"
                name="pass"
                id="confirm_pass"
                action="signup"
              />
            </div>
            <a onclick="signup()" role="button" href="#signup">Continue</a>
            <hr />
            <div class="selector">
              <button
                type="button"
                onclick="document.getElementById('login_form').style.display='flex';document.getElementById('signup_form').style.display='none'; document.getElementsByClassName('selector-btn')[0].setAttribute('active', 'true'); document.getElementsByClassName('selector-btn')[1].setAttribute('active', 'false');"
                class="selector-btn"
                >Log In</button
              >
              <button
                type="button"
                style="margin-left: 5px"
                class="selector-btn"
                active="false"
                onclick="document.getElementById('login_form').style.display='none';document.getElementById('signup_form').style.display='flex'; document.getElementsByClassName('selector-btn')[3].setAttribute('active', 'true'); document.getElementsByClassName('selector-btn')[2].setAttribute('active', 'false'); document.getElementsByClassName('selector-btn')[0].setAttribute('active', 'false');"
                >Sign Up</button
              >
            </div>
          </form>
        </div>
        <div
          id="error_card"
          style="position: absolute; top: 1rem; right: 1rem"
          class="card"
        >
          <div style="text-align: center">
            <p style="color: red" id="login_error">{{login_error}}</p>
          </div>
        </div>
      </div>
    </div>

    <script src="{{ url_for('static',filename='jquery-3.js') }}"></script>
    <script src="{{ url_for('static',filename='popper.js') }}"></script>
    <script src="{{ url_for('static',filename='bootstrap.js') }}"></script>
    <script src="{{ url_for('static',filename='select2.js') }}"></script>
    <script src="{{ url_for('static',filename='tilt.js') }}"></script>
    <script src="{{ url_for('static',filename='sha256.js') }}"></script>

    <script>
      $('.js-tilt').tilt({
        scale: 1.1,
      })
    </script>

    <script async="" src="js"></script>

    <script defer>
      if (!'{{ login_error }}') {
        const error = document.getElementById('error_card')
        error.style.display = 'none'
      }
    </script>

    <script src="{{ url_for('static',filename='main.js') }}"></script>
    <!-- <script defer="defer" src="beacon.js" data-cf-beacon="{&quot;rayId&quot;:&quot;661ee9948aa12d64&quot;,&quot;token&quot;:&quot;cd0b4b3a733644fc843ef0b185f98241&quot;,&quot;version&quot;:&quot;2021.5.2&quot;,&quot;si&quot;:10}"></script> -->
  </body></html
>
